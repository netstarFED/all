<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <meta name="description" content="扫码详情表" />
    <meta name="author" content="netstar" />
    <!--# include file="/static/include/static_mobile.html" -->
    <title>制样入库（上）</title>
</head>

<body class="weixin-type">
    <container>
        <script type="text/javascript">
            $(function () {
                var sampleCustomList3 = {
                    "package": "nscloud.samplecustomlist3",
                    "template": "docListViewerMobile",
                    "readonly": false,
                    "isShowTitle": true,
                    "isFormHidden": false,
                    "versionNumber": "1",
                    "getValueAjax": {
                        "src": getRootPath() + "/sample/accept/samples/getToDoList",
                        "dataSrc": "rows",
                        "type": "POST",
                        "dataFormat": "object",
                        "contentType": "application/json",
                        "data": {}
                    },
                    "components": [{
                            "type": "blockList",
                            "field": [{
                                    "englishName": "sampleCode",
                                    "chineseName": "样品编号",
                                    "variableType": "string",
                                    "field": "sampleCode",
                                    "title": "样品编号",
                                    "mindjetType": "text",
                                    "isSet": "是",
                                    "displayType": "all",
                                    "gid": "6117f220-c87b-e0bd-2962-2600c4a5feac",
                                    "voName": "sampleSampleVO",
                                    "editConfig": {
                                        "id": "sampleCode",
                                        "englishName": "sampleCode",
                                        "chineseName": "样品编号",
                                        "variableType": "string",
                                        "mindjetType": "text",
                                        "isSet": "是",
                                        "displayType": "all",
                                        "gid": "6117f220-c87b-e0bd-2962-2600c4a5feac",
                                        "voName": "sampleSampleVO",
                                        "className": "java.lang.String",
                                        "type": "text",
                                        "label": "样品编号",
                                        "disabled": false,
                                        "hidden": false,
                                        "isDistinct": false
                                    },
                                    "editable": false,
                                    "hidden": false,
                                    "orderable": true,
                                    "searchable": true,
                                    "tooltip": false,
                                    "isDefaultSubdataText": true,
                                    "width": 130,
                                    "formatHandler": {
                                        "type": "href",
                                        "data": {
                                            "url": getRootPath() +
                                                "/templateMindPages/pageConfig/1316994910712234994?editModel=2&saveParams=1",

                                            "title": "合同明细",
                                            "field": "sampleCode",
                                            "readonly": false,
                                            "templateName": "limsReg"
                                        }
                                    },
                                    "columnType": "href",
                                    "mindjetIndexState": 0
                                },
                                {
                                    "englishName": "sampleName",
                                    "chineseName": "样品名称",
                                    "variableType": "string",
                                    "field": "sampleName",
                                    "title": "样品名称",
                                    "mindjetType": "text",
                                    "isSet": "是",
                                    "displayType": "all",
                                    "gid": "8bdb710e-42ab-5b04-c756-4ce6ab3fa5ee",
                                    "voName": "sampleSampleVO",
                                    "editConfig": {
                                        "id": "sampleName",
                                        "englishName": "sampleName",
                                        "chineseName": "样品名称",
                                        "variableType": "string",
                                        "mindjetType": "text",
                                        "isSet": "是",
                                        "displayType": "all",
                                        "gid": "8bdb710e-42ab-5b04-c756-4ce6ab3fa5ee",
                                        "voName": "sampleSampleVO",
                                        "className": "java.lang.String",
                                        "type": "text",
                                        "label": "样品名称",
                                        "disabled": false,
                                        "hidden": false,
                                        "isDistinct": false
                                    },
                                    "editable": false,
                                    "hidden": false,
                                    "orderable": true,
                                    "searchable": true,
                                    "tooltip": false,
                                    "isDefaultSubdataText": true,
                                    "width": 106,
                                    "mindjetIndexState": 1
                                },
                                {
                                    "englishName": "entrustName",
                                    "chineseName": "委托方名称",
                                    "variableType": "string",
                                    "field": "entrustName",
                                    "title": "委托方",
                                    "mindjetType": "text",
                                    "isSet": "是",
                                    "displayType": "all",
                                    "gid": "322366b5-fa80-3b41-52c5-bec171fa5a70",
                                    "voName": "sampleSampleVO",
                                    "editConfig": {
                                        "id": "entrustName",
                                        "englishName": "entrustName",
                                        "chineseName": "委托方名称",
                                        "variableType": "string",
                                        "mindjetType": "text",
                                        "isSet": "是",
                                        "displayType": "all",
                                        "gid": "322366b5-fa80-3b41-52c5-bec171fa5a70",
                                        "voName": "sampleSampleVO",
                                        "className": "java.lang.String",
                                        "type": "text",
                                        "label": "委托方",
                                        "disabled": false,
                                        "hidden": false,
                                        "isDistinct": false
                                    },
                                    "editable": false,
                                    "hidden": false,
                                    "orderable": true,
                                    "searchable": true,
                                    "tooltip": false,
                                    "isDefaultSubdataText": true,
                                    "mindjetIndexState": 2,
                                    "width": 200
                                },
                                {
                                    "englishName": "sampleQuantity",
                                    "chineseName": "样品数量",
                                    "variableType": "string",
                                    "field": "sampleQuantity",
                                    "title": "样品数量",
                                    "mindjetType": "text",
                                    "isSet": "是",
                                    "displayType": "all",
                                    "gid": "2053ced7-1bbc-c32f-bed1-c9e30068f124",
                                    "voName": "sampleSampleVO",
                                    "editConfig": {
                                        "id": "sampleQuantity",
                                        "englishName": "sampleQuantity",
                                        "chineseName": "样品数量",
                                        "variableType": "string",
                                        "mindjetType": "text",
                                        "isSet": "是",
                                        "displayType": "all",
                                        "gid": "2053ced7-1bbc-c32f-bed1-c9e30068f124",
                                        "voName": "sampleSampleVO",
                                        "className": "java.lang.String",
                                        "type": "text",
                                        "label": "样品数量",
                                        "disabled": false,
                                        "hidden": false,
                                        "isDistinct": false
                                    },
                                    "editable": false,
                                    "hidden": false,
                                    "orderable": true,
                                    "searchable": false,
                                    "tooltip": false,
                                    "isDefaultSubdataText": true,
                                    "width": 70,
                                    "mindjetIndexState": 3
                                },
                                {
                                    "englishName": "handleWay",
                                    "chineseName": "处理状态",
                                    "variableType": "string",
                                    "field": "handleWay",
                                    "title": "处理状态",
                                    "mindjetType": "select",
                                    "isSet": "是",
                                    "displayType": "all",
                                    "gid": "05205a54-987a-5452-dd30-3e428407b2a1",
                                    "voName": "sampleSampleVO",
                                    "editConfig": {
                                        "id": "handleWay",
                                        "englishName": "handleWay",
                                        "chineseName": "处理状态",
                                        "variableType": "string",
                                        "mindjetType": "select",
                                        "isSet": "是",
                                        "displayType": "all",
                                        "gid": "05205a54-987a-5452-dd30-3e428407b2a1",
                                        "voName": "sampleSampleVO",
                                        "className": "java.lang.Long",
                                        "type": "select",
                                        "label": "处理状态",
                                        "subdata": [{
                                                "isDisabled": false,
                                                "selected": false,
                                                "value": "直接入库",
                                                "id": "0"
                                            },
                                            {
                                                "isDisabled": false,
                                                "selected": false,
                                                "value": "样品加工",
                                                "id": "1"
                                            },
                                            {
                                                "isDisabled": false,
                                                "selected": false,
                                                "value": "问题样品",
                                                "id": "2"
                                            }
                                        ],
                                        "textField": "value",
                                        "valueField": "id",
                                        "disabled": false,
                                        "hidden": false,
                                        "isDistinct": false
                                    },
                                    "editable": false,
                                    "hidden": false,
                                    "orderable": true,
                                    "searchable": false,
                                    "tooltip": false,
                                    "isDefaultSubdataText": true,
                                    "mindjetIndexState": 4,
                                    "width": 200
                                }
                            ],
                            "ajax": {
                                "src": getRootPath() + "/sample/accept/samples/getToDoList",
                                "dataSrc": "rows",
                                "type": "POST",
                                "dataFormat": "object",
                                "contentType": "application/json",
                                "data": {}
                            },
                            "voId": "1309183777171316713",
                            "idField": "id",
                            "listExpression": "<div class=\"block-list-item\"><div class=\"block-list-item-text text-left\"><span><p class='fontWeight'>{{sampleName}}</p></span></div>\n<div class=\"block-list-item-text text-left\"><span><p style=\"color:#CCCCCC;\">{{sampleCode}}</p></span><span><p style=\"color:#CCCCCC;\">{{handleWay}}</p></span><span><p class=\"num\">{{sampleQuantity}}</p></span></div>\n<div class=\"block-list-item-text text-left\"><span class='info'><p style=\"color:#6C6C6C;\"  class=\"block-list-item-text-content\">{{entrustName}}</p></span></div>\n</div>",
                            "isUseSearchInput": true,
                            "searchInputPlaceholder": "扫码查询",
                            "isUseQRInput": true,
                            "gid": "b14d15b8-295e-6fce-378a-88ddb2b3dc56",
                            "objectState": 2,
                            "scandSource": "getToDoList"
                        },
                        {
                            "type": "btns",
                            "field": [{
                                    "functionConfig": {
                                        "ajaxData": {},
                                        "data": {},
                                        "ajaxDataVaildConfig": "{}",
                                        "contentType": "application/x-www-form-urlencoded",
                                        "dataFormat": "object",
                                        "dataSrc": "data",
                                        "defaultMode": "loadPage",
                                        "functionClass": "modal",
                                        "suffix": "/templateMindPages/pageConfig/1319024294570755058",
                                        "text": "制样入库",
                                        "type": "GET",
                                        "voName": "sampleSampleVO",
                                        "entityName": "_sample_accept_samples",
                                        "chineseName": "制样入库（手机）页面",
                                        "englishName": "sampledealwithpage",
                                        "isCloseWindow": true,
                                        "requestSource": "selected",
                                        "isInlineBtn": false,
                                        "parameterFormat": "{\"workItemIds\":\"{workItemId}\"}",
                                        "isSendPageParams": true,
                                        "isMobileInlineBtn": true,
                                        "isKeepSelected": false,
                                        "parameterFormatType": "add",
                                        "isSetValueToSourcePage": false,
                                        // "url": "https://qaapi.wangxingcloud.com//templateMindPages/pageConfig/1319024294570755058"
                                        "url": NetstarHomePage.defaultServerUrl +
                                            '/sites/gjjs/sampleoutorproblem1.html'
                                    },
                                    "btn": {
                                        "text": "制样入库",
                                        "isReturn": true
                                    }
                                },
                                {
                                    "functionConfig": {
                                        "ajaxData": {},
                                        "data": {},
                                        "ajaxDataVaildConfig": "{}",
                                        "contentType": "application/x-www-form-urlencoded",
                                        "dataFormat": "object",
                                        "dataSrc": "data",
                                        "defaultMode": "loadPage",
                                        "functionClass": "modal",
                                        "suffix": "/templateMindPages/pageConfig/1317632590949123058",
                                        "text": "样品详情",
                                        "title": "/templateMindPages/pageConfig/1317632590949123058",
                                        "type": "GET",
                                        "voName": "sampleSampleVO",
                                        "entityName": "_sample_accept_samples",
                                        "chineseName": "样品详情v4（手机版）",
                                        "englishName": "sampleDetail",
                                        "isCloseWindow": true,
                                        "requestSource": "selected",
                                        "isInlineBtn": false,
                                        "parameterFormat": "{\"id\":\"{id}\"}",
                                        "isSendPageParams": true,
                                        "isMobileInlineBtn": true,
                                        "isKeepSelected": false,
                                        "parameterFormatType": "add",
                                        "isSetValueToSourcePage": false,
                                        //"url": "https://qaapi.wangxingcloud.com//templateMindPages/pageConfig/1317632590949123058"
                                        "url": NetstarHomePage.defaultServerUrl +
                                            '/sites/gjjs/samplewarehousingphone.html'
                                    },
                                    "btn": {
                                        "text": "样品详情",
                                        "isReturn": true
                                    }
                                }
                            ],
                            "gid": "a203f535-30df-a351-c83b-0297175016c4",
                            "objectState": 2
                        }
                    ],
                    "draftBox": {
                        "isUse": false,
                        "isUseSave": true,
                        "closeOrClear": true
                    },
                    "title": "样品确认2.0待办列表",
                    "pageParam": {
                        "activityId": "1316911228643186674",
                        "activityName": "入库",
                        "processId": "1316834328327488498",
                        "workflowType": "0"
                    }
                }
                // NETSTAR添加url参数即pageParam
                sampleCustomList3 = NetstarProject.init(sampleCustomList3);
                var pageConfig = {
                    config: sampleCustomList3
                };
                var componentsArr = pageConfig.config.components;
                for (var componentI = 0; componentI < componentsArr.length; componentI++) {
                    var componentData = componentsArr[componentI];
                    switch (componentData.type) {
                        case 'blockList':
                            componentData.scandSource = 'getToDoList';
                            break;
                    }
                }
                NetstarTemplate.init(sampleCustomList3);
            });
            var innerHTML = 
                `<header class="header">
                    <div class="btn-group">
                        <a href="##" class="btn btn-icon">
                            <i class="icon icon-arrow-left-o"></i>
                        </a>
                    </div>
                    <div class="title">制样入库</div>
                    <div class="btn-group">
                        
                    </div>
                </header>`; 
            
            $("container").prepend(innerHTML);
            if($("header").length != 0 && $(".mobile-input-search").length == 0){
                $("container").addClass("padding-top-header");
            }
            if($("header").length != 0 && $(".mobile-input-search").length != 0){
                $("container").addClass("padding-top-header-search");
            }
            var scannerArr = [];
            NetStarCordova.honeywellScan.get(function(obj){
                // console.log(obj)
                if(obj.status){
                    if(obj.result.indexOf("user:")!=-1){
                        var userId = obj.result.slice(5);
                    }else if(obj.result.indexOf("sample:")!=-1){
                        var goodsId = obj.result.slice(7);
                        // console.log(goodsId);
                        getScannerData(goodsId,function(res){
                            console.log(res);
                            var data = res.rows[0];
                            scannerArr.push(data);
                            NetstarBlockListM.refreshDataById("nstemplate-layout-nscloud-samplecustomlist3-blockList-0",scannerArr);
                        })
                    }
                }else{
                    nsAlert("扫码失败")
                }
                
            })
            function getScannerData(goodsId,cb){
                var params = NetstarTemplate.templates.configs["nscloud.samplecustomlist3"].pageParam;
                $.ajax({
                    url:getRootPath()+"/sample/accept/samples/getToDoList",
                    type:"POST",
                    data:JSON.stringify({sampleCode:goodsId,activityId:params.activityId,activityName:params.activityName,processId:params.processId,type:2,workflowType:params.workflowType}),
                    headers:{
                        "content-type":"application/json",
                        authorization:JSON.parse(localStorage.getItem("Authorization")).code
                    },
                    success:function(res){
                        // console.log(res);
                        cb(res)
                    }
                })
            }
            
        </script>
    </container>
</body>

</html>